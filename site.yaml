---
- hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - name: Create Kasten-io namespace.
      kubernetes.core.k8s:
        name: helm-tutorial
        api_version: v1
        kind: Namespace
        state: present
        kubeconfig: ./.kube/admin.kubeconfig
        context: "develop"
    - name: Add Stable helm repository.
      kubernetes.core.helm_repository:
        name: stable
        repo_url: "https://charts.helm.sh/stable"
    - name: Deploy latest version of Grafana chart inside monitoring namespace with values
      kubernetes.core.helm:
        name: stable
        chart_ref: stable/prometheus
        release_namespace: helm-tutorial
        state: present
        kubeconfig: ./.kube/admin.kubeconfig
        context: "develop"
        # - name: Add stable chart repo
        #   kubernetes.core.helm_repository:
        #     name: stable
        #     repo_url: "https://charts.helm.sh/stable"