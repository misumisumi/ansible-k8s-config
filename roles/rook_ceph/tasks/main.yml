---
# tasks file for rook_ceph
- name: Add rook chart repo
  kubernetes.core.helm_repository:
    name: rook-release
    repo_url: "https://charts.rook.io/release"
    kubeconfig: "{{ kubeconfig }}"
    context: "{{ stage }}"

- name: Deploy latest version of rook/ceph-operator chart
  kubernetes.core.helm:
    name: rook-ceph
    chart_ref: rook-release/rook-ceph
    release_namespace: rook-ceph
    create_namespace: true
    values_files:
      - "roles/rook_ceph/files/operator-{{ stage }}.yml"
    kubeconfig: "{{ kubeconfig }}"
    context: "{{ stage }}"

- name: Deploy latest version of rook/ceph-cluster chart
  kubernetes.core.helm:
    name: rook-ceph-cluster
    chart_ref: rook-release/rook-ceph-cluster
    release_namespace: rook-ceph
    create_namespace: true
    values_files:
      - "roles/rook_ceph/files/cluster-{{ stage }}.yml"
    kubeconfig: "{{ kubeconfig }}"
    context: "{{ stage }}"